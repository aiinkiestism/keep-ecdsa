name: Go

#TODO: extend the conditions once workflow gets tested together with other workflows 
on:  
  push:
    # branches:
    #  - master
  pull_request:
  workflow_dispatch:

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: satackey/action-docker-layer-caching@v0.0.11
        continue-on-error: true # ignore the failure of a step and avoid terminating the job
      - name: Run Docker build
        run: | # do we need to add GOPRIVATE param?
           docker build \
             --target gobuild \
             --tag go-build-env . 
      - name: Run Go tests
        run: |
          docker run \
            --workdir /go/src/github.com/keep-network/keep-ecdsa \
            go-build-env \
            go test ./.../
      - name: Build keep-ecdsa runtime image
        run: |
          docker build \
            --tag keep-ecdsa .